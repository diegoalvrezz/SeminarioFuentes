---
title: "seminario fuentes"
author: "Pablo, Diego y Dario"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:


Importamos las bases de datos
```{r}
library(readr)
library(tidyverse)
aire <- read_delim("./C6H6_BaP__2021_Irreg.csv")

fumadores<-read_delim("./Datos_fumadores/Fumadores.csv", delim = ";")
fumadores

defunciones_mes <- read_delim("./DATA/defuncion_mes.csv", delim =";")
defunciones_mes

defuncion_poblacion <- read_delim("./DATA/defuncion_poblacion.csv", delim =";")
defuncion_poblacion
#arboles_superficie <- read_delim("./Datos_arboles/provincia_superficie_altura.csv", delim = ";")

arboles_uso <- read_delim("./Datos_arboles/Arbolesusofinal.csv", delim = ";",escape_double = FALSE, trim_ws = TRUE)
arboles_uso

#arboles_extension <- read_delim("./Datos_arboles/provincia_extensionterritorio.csv", delim = ";")

habitantes <- read_delim("./DATA/48254.csv", delim = ";")
habitantes
```


```{r}
library(dplyr)
tabla_relacionada <- inner_join(fumadores, arboles_uso, by = c("Comunidades y Ciudades Autónomas" = "Comunidades"))
```


```{r}
library(dplyr)
fumadores <- fumadores%>%
  mutate(
    CCAA_fumadores= case_when( ## cambiamos el nombre con un case_When
      fumadores$`Comunidades y Ciudades Autónomas`== "Andalucía" ~ "Andalucia",
      fumadores$`Comunidades y Ciudades Autónomas`== "Aragón" ~ "Aragon",
      fumadores$`Comunidades y Ciudades Autónomas`== "Asturias (Principado de)" ~ "Asturias",
      fumadores$`Comunidades y Ciudades Autónomas`== "Balears (Illes)" ~ "Baleares",
      fumadores$`Comunidades y Ciudades Autónomas`== "Canarias" ~ "Canarias",
      fumadores$`Comunidades y Ciudades Autónomas`== "Cantabria" ~ "Cantabria",
      fumadores$`Comunidades y Ciudades Autónomas`== "Castilla y León" ~ "CyL",
      fumadores$`Comunidades y Ciudades Autónomas`== "Castilla - La Mancha" ~ "Castilla la Mancha",
      fumadores$`Comunidades y Ciudades Autónomas`== "Cataluña" ~ "Cataluña",
      fumadores$`Comunidades y Ciudades Autónomas`== "Comunitat Valenciana" ~ "C.Valencia",
      fumadores$`Comunidades y Ciudades Autónomas`== "Extremadura" ~ "Extremadura",
      fumadores$`Comunidades y Ciudades Autónomas`== "Galicia" ~ "Galicia",
      fumadores$`Comunidades y Ciudades Autónomas`== "Madrid (Comunidad de)" ~ "Madrid",
      fumadores$`Comunidades y Ciudades Autónomas`== "Murcia (Región de)" ~ "Murcia",
      fumadores$`Comunidades y Ciudades Autónomas`== "Navarra (Comunidad Foral de)" ~ "Navarra",
      fumadores$`Comunidades y Ciudades Autónomas`== "País Vasco" ~ "País Vasco",
      fumadores$`Comunidades y Ciudades Autónomas`== "Rioja (La)" ~ "La Rioja",
      fumadores$`Comunidades y Ciudades Autónomas`== "Ceuta (Ciudad Autónoma de)" ~ "Ceuta",
      fumadores$`Comunidades y Ciudades Autónomas`== "Melilla (Ciudad Autónoma de)" ~ "Melilla",
    )) %>%
select(`CCAA_fumadores`,`Consumo de tabaco`,Total,) %>%
  na.exclude()
fumadores
      
    
  
  
aire<- aire%>%
  mutate(
    CCAA_aire=case_when(
      aire$PROVINCIA=="18" ~ "Granada",
      aire$PROVINCIA=="33" ~ "Asturias",
      aire$PROVINCIA=="46" ~ "Valencia",
      aire$PROVINCIA=="25" ~ "Cataluña",
      aire$PROVINCIA=="45" ~ "Toledo",
      aire$PROVINCIA=="50" ~ "Zaragoza",
      aire$PROVINCIA=="41" ~ "Sevilla",
      aire$PROVINCIA=="23" ~ "Jaén",
      aire$PROVINCIA=="13" ~ "Ciudad Real",
      aire$PROVINCIA=="16" ~ "Cuenca",
      aire$PROVINCIA=="4" ~ "Almería",
      aire$PROVINCIA=="14" ~ "Córdoba",
      aire$PROVINCIA=="29" ~ "Málaga",
      aire$PROVINCIA=="19"~ "Guadalajara",
      aire$PROVINCIA=="2" ~ "Albacete",
      aire$PROVINCIA=="47" ~ "Valladolid",
      aire$PROVINCIA=="24" ~ "León",
      aire$PROVINCIA=="9" ~ "Burgos",
      aire$PROVINCIA=="22" ~ "Huesca",
      aire$PROVINCIA=="12" ~ "Castellón",
    )
  )
aire

```



```{r}
library(dplyr)
arboles_uso<- arboles_uso%>%
  mutate(
    CCAA_arboles_uso=case_when(
      arboles_uso$Comunidad=="ANDALUCÍA" ~ "Andalucia",
      arboles_uso$Comunidad=="ARAGÓN" ~ "Aragon",
      arboles_uso$Comunidad=="CANARIAS" ~ "Canarias",
      arboles_uso$Comunidad=="CANTABRIA" ~ "Cantabria",
      arboles_uso$Comunidad=="CASTILLA LA MANCHA" ~ "Castilla la Mancha",
      arboles_uso$Comunidad=="CASTILLA Y LEÓN" ~ "CyL",
      arboles_uso$Comunidad=="CATALUÑA" ~ "Cataluña",
      arboles_uso$Comunidad=="COMUNIDAD DE MADRID" ~ "Madrid",
      arboles_uso$Comunidad=="COMUNIDAD FORAL DE NAVARRA" ~ "Navarra",
      arboles_uso$Comunidad=="COMUNIDAD VALENCIANA" ~ "C.Valencia",
      arboles_uso$Comunidad=="EXTREMADURA" ~ "Extremadura",
      arboles_uso$Comunidad=="GALICIA" ~ "Galicia",
      arboles_uso$Comunidad=="ILLES BALEARS" ~ "Baleares",
      arboles_uso$Comunidad=="LA RIOJA" ~ "La Rioja",
      arboles_uso$Comunidad=="PAÍS VASCO" ~ "País Vasco",
      arboles_uso$Comunidad=="PRINCIPADO DE ASTURIAS" ~ "Asturias",
      arboles_uso$Comunidad=="REGIÓN DE MURCIA" ~ "Murcia",
    ))%>%
select(`CCAA_arboles_uso`,`Usos`,`0 - 199`,`200 - 399`,`400 - 599`,`600 - 799`,`800 - 999`,`1.000 - 1.199`,`1.200 - 1.399`,`1.400 - 1.599`,`1.600 - 1.799`,`1.800 - 1.999`,`>= 2.000`) %>%
  na.exclude()
  

arboles_uso



```


```{r}
# Agrupa los datos por CCAA y calcula la media
aire_agrupado <- aire %>%
  group_by(CCAA_aire) %>%
  summarise(media = mean(VALOR, na.rm = TRUE))%>%
   mutate(
    COMUNIDADES = case_when(
      CCAA_aire %in% c("Granada", "Almería", "Sevilla", "Jaén", "Córdoba", "Málaga") ~ "Andalucia",
      CCAA_aire %in% c("León", "Burgos", "Valladolid") ~ "Castilla y León",
      CCAA_aire %in% c("Huesca", "Zaragoza") ~ "Aragón",
      CCAA_aire %in% c("Cuenca", "Toledo", "Ciudad Real", "Guadalajara", "Albacete") ~ "Castilla la Mancha",
      CCAA_aire %in% c("Castellón", "Valencia") ~ "C.Valencia",
     
      TRUE ~ CCAA_aire
    )
    
  )
```


```{r}
# Calcula la media por grupo
aire_media_comunidad <- aire_agrupado %>%
  group_by(COMUNIDADES) %>%
  summarise(media = mean(media, na.rm = TRUE))
```


```{r}
tumores<-defuncion_poblacion %>%
  rename("Total" = ...2,"<10000" = ...3,"10000-20000" = ...4, "20000-50000" = ...5,"50000-100000" = ...6, "<100000" = ...7, "Capital" = ...8 ) %>%
  slice(55:58) %>%
  select('Defunciones según causa de muerte. Avance enero-mayo 2020':Capital)

tumores
```


```{r}
habitantes_refinado <- habitantes %>%
  filter(Periodo == "1/1/2020") %>%
  select('Comunidades y Ciudades Autónomas', Total, Periodo) %>%
  na.exclude()


habitantes_refinado <- habitantes_refinado %>%
  mutate(
    CCAA_habitantes_refinado = case_when(
      habitantes_refinado$`Comunidades y Ciudades Autónomas` == "Andalucía" ~ "Andalucia",
      habitantes_refinado$`Comunidades y Ciudades Autónomas` == "Aragón" ~ "Aragon",
      habitantes_refinado$`Comunidades y Ciudades Autónomas` == "Canarias" ~ "Canarias",
      habitantes_refinado$`Comunidades y Ciudades Autónomas` == "Cantabria" ~ "Cantabria",
      habitantes_refinado$`Comunidades y Ciudades Autónomas` == "Castilla - La Mancha" ~ "Castilla la Mancha",
      habitantes_refinado$`Comunidades y Ciudades Autónomas` == "Castilla y León" ~ "CyL",
      habitantes_refinado$`Comunidades y Ciudades Autónomas` == "Cataluña" ~ "Cataluña",
      habitantes_refinado$`Comunidades y Ciudades Autónomas` == "Madrid, Comunidad de" ~ "Madrid",
      habitantes_refinado$`Comunidades y Ciudades Autónomas` == "Navarra, Comunidad Foral de" ~ "Navarra",
      habitantes_refinado$`Comunidades y Ciudades Autónomas` == "Comunitat Valenciana" ~ "C.Valencia",
      habitantes_refinado$`Comunidades y Ciudades Autónomas` == "Extremadura" ~ "Extremadura",
      habitantes_refinado$`Comunidades y Ciudades Autónomas` == "Galicia" ~ "Galicia",
      habitantes_refinado$`Comunidades y Ciudades Autónomas` == "Balears, Illes" ~ "Baleares",
      habitantes_refinado$`Comunidades y Ciudades Autónomas` == "Rioja, La" ~ "La Rioja",
      habitantes_refinado$`Comunidades y Ciudades Autónomas` == "País Vasco" ~ "País Vasco",
      habitantes_refinado$`Comunidades y Ciudades Autónomas` == "Asturias, Principado de" ~ "Asturias",
      habitantes_refinado$`Comunidades y Ciudades Autónomas` == "Murcia, Región de" ~ "Murcia"
    ))%>%
select('CCAA_habitantes_refinado',Total,Periodo)%>%
  na.exclude()

habitantes_refinado

```



```{r}
arboles_uso <- arboles_uso %>%
  mutate(
    `0 - 199` = as.numeric(gsub(',', '.', gsub('\\.', '', .$`0 - 199`))),
    `600 - 799` = as.numeric(gsub(',', '.', gsub('\\.', '', .$`600 - 799`))),
    `1.600 - 1.799` = as.numeric(gsub(',', '.', gsub('\\.', '', .$`1.600 - 1.799`)))
     )

arboles_uso <- arboles_uso %>% 
  replace_na(list(arboles_uso))
arboles_uso


```





